###### Basic app settings
NODE_ENV=production
LISTEN_HOST=0.0.0.0
LISTEN_PORT=8080
# BASE_PATH=
LOG_LEVEL=warn
# Force application timezone (affects pretty logs)
TZ=UTC

###### Database
DATABASE_URL=postgresql://media_user:changeme@localhost:5432/media_storage

###### S3 Storage (Garage)
S3_ENDPOINT=http://localhost:3900
S3_REGION=garage
S3_ACCESS_KEY_ID=your_access_key
S3_SECRET_ACCESS_KEY=your_secret_key
S3_BUCKET=media-files
S3_FORCE_PATH_STYLE=true

###### File Upload Limits
MAX_FILE_SIZE_MB=100
BLOCK_EXECUTABLE_UPLOADS=true
BLOCK_ARCHIVE_UPLOADS=true

###### Upload From URL
# When true (default), blocks unsafe URL downloads:
# - only HTTPS
# - blocks localhost, local DNS names, and private IP ranges
URL_UPLOAD_BLOCK_UNSAFE_CONNECTIONS=true
# Download timeout in milliseconds
URL_UPLOAD_TIMEOUT_MS=15000
# Max file size in megabytes for URL download
URL_UPLOAD_MAX_BYTES_MB=100
# Max redirects to follow
URL_UPLOAD_MAX_REDIRECTS=3

###### Image Limits
# Max size in megabytes for image processing (default 25MB)
# Used for:
# - image upload size limit
# - reading images into memory for EXIF/thumbnail/optimization
# Set to 0 to disable in-memory image processing limits (not recommended)
IMAGE_MAX_BYTES_MB=25

###### Image Compression (Upload)
# Force compression for all uploads (ignores optimize parameter in request)
FORCE_IMAGE_COMPRESSION_ENABLED=false

# Compression modes:
# - FORCE_IMAGE_COMPRESSION_ENABLED=true: request compression params are ignored, settings below are used.
# - FORCE_IMAGE_COMPRESSION_ENABLED=false: compression is applied only when request includes "optimize" params.
#   In this mode, settings below act as defaults/limits (e.g. maxDimension is capped).

# Format used by default (webp or avif)
IMAGE_COMPRESSION_FORMAT=webp
# Max dimensions
IMAGE_COMPRESSION_MAX_DIMENSION=3840
# Strip metadata (EXIF/ICC/XMP) during compression
IMAGE_COMPRESSION_STRIP_METADATA=false
# Enable lossless compression
IMAGE_COMPRESSION_LOSSLESS=false
# Shared quality/effort settings for both WebP and AVIF.
# Format-specific knobs are intentionally not exposed because the output format is not expected
# to change frequently.
IMAGE_COMPRESSION_QUALITY=80
IMAGE_COMPRESSION_EFFORT=6
# AVIF chroma subsampling.
# When unset, subsampling is not overridden (sharp encoder default is used).
# Reasonable values:
# - 4:2:0: smallest file size (recommended)
# - 4:4:4: better color fidelity, usually larger
IMAGE_COMPRESSION_AVIF_CHROMA_SUBSAMPLING=4:2:0

###### Thumbnails
THUMBNAIL_FORMAT=webp
THUMBNAIL_MAX_DIMENSION=2048
THUMBNAIL_MAX_AGE_DAYS=90
# Thumbnail quality and effort (applied to selected format)
THUMBNAIL_QUALITY=80
THUMBNAIL_EFFORT=6

###### Image Processing Microservice
# Base URL for external image processing service.
# Expected endpoints:
# - POST /process
# - POST /exif
IMAGE_PROCESSING_BASE_URL=http://localhost:8080/api/v1
# Request timeout in milliseconds for calls to image processing service
IMAGE_PROCESSING_REQUEST_TIMEOUT_MS=60000

###### Shutdown
# Maximum time to wait for in-flight tasks during graceful shutdown
SHUTDOWN_TIMEOUT_MS=30000

###### Cleanup Job
CLEANUP_ENABLED=true
CLEANUP_CRON=0 */6 * * *
# TTL for files with bad status (uploading/deleting/failed/missing)
CLEANUP_BAD_STATUS_TTL_DAYS=7
# Delay between retry attempts for soft-deleted files (prevents tight loops on failures)
CLEANUP_SOFT_DELETED_RETRY_DELAY_MINUTES=30
# Warn if a soft-deleted file remains pending cleanup longer than this threshold
CLEANUP_SOFT_DELETED_STUCK_WARN_DAYS=3
# Batch size for cleanup operations
CLEANUP_BATCH_SIZE=200
# TTL for tmp/ objects in S3 (prefix tmp/)
CLEANUP_TMP_TTL_DAYS=2
# TTL for originals/ objects in S3 (prefix originals/)
CLEANUP_ORIGINALS_TTL_DAYS=14
# Max keys per ListObjectsV2 request
CLEANUP_S3_LIST_PAGE_SIZE=1000
# TTL for unused thumbnails is controlled by THUMBNAIL_MAX_AGE_DAYS